<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="EclipseOpenBSWDocumentation" name="dox_trace_storage" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working with CAN &mdash; Eclipse OpenBSW Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/rtd_theme_overrides.css?v=6fd0d55b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../_static/colors.css?v=3cafd8aa" />
      <link rel="stylesheet" type="text/css" href="../../../_static/colored_table.css?v=34b816d5" />
      <link rel="stylesheet" type="text/css" href="../../../_static/header.css?v=e632285e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dox_util_colors.css?v=dd14b177" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dox_trace.css?v=60d3f72c" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../../_static/dox_trace.js?v=40719b51"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Using UDS" href="../uds/index.html" />
    <link rel="prev" title="Adding commands to the console" href="../commands/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Eclipse OpenBSW Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../overview.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../setup/index.html">Set up your environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layout/index.html">Understanding the directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console/index.html">Using the console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unit_tests/index.html">Building and Running Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle/index.html">Managing the lifecycle of components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging to the console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Adding commands to the console</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Working with CAN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#posix-build">POSIX build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#s32k148-build">S32K148 build</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../uds/index.html">Using UDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hwio/index.html">Using hardware I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracing/index.html">Tracing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../SysTest/HW_Testing_Guide.html">Hardware Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/UdsTool/doc/index.html">UdsTool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../codingGuidelines/index.html">Coding Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/posix/index.html">POSIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/s32k148evb/index.html">S32K148 Evaluation Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/application/doc/index.html">application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/asyncBinding/doc/index.html">asyncBinding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/asyncCoreConfiguration/doc/index.html">asyncCoreConfiguration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/configuration/doc/index.html">configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/consoleCommands/doc/index.html">consoleCommands - Command utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/posix/freeRtosCoreConfiguration/doc/index.html">freeRtosCoreConfiguration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/posix/main/doc/index.html">main</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/s32k148evb/bspConfiguration/doc/index.html">bspConfiguration - S32k148EVB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/s32k148evb/freeRtosCoreConfiguration/doc/index.html">freeRtosCoreConfiguration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/s32k148evb/main/doc/index.html">main</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/transportConfiguration/doc/index.html">transportConfiguration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/udsConfiguration/doc/index.html">udsConfiguration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BSW Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/async/doc/index.html">async - Asynchronous Execution Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/asyncConsole/doc/index.html">asyncConsole - Asynchronous Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/asyncFreeRtos/doc/index.html">asyncFreeRtos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/asyncImpl/doc/index.html">asyncImpl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/bsp/doc/index.html">bsp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/common/doc/index.html">common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/cpp2can/doc/index.html">cpp2can - CAN Abstraction Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/docan/doc/index.html">docan - Diagnostics over CAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/io/doc/index.html">io - IO Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/lifecycle/doc/index.html">lifecycle - App Lifecycle Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/logger/doc/index.html">logger - Logger module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/loggerIntegration/doc/index.html">loggerIntegration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/platform/doc/index.html">platform - Platform Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/runtime/doc/index.html">runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/stdioConsoleInput/doc/index.html">stdioConsoleInput</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/timer/doc/index.html">timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/transport/doc/index.html">transport - Transport Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/transportRouterSimple/doc/index.html">transportRouterSimple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/uds/doc/index.html">uds - Unified Diagnostic Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsw/util/doc/index.html">util</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Safety Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/safety/safeMonitor/doc/index.html">safeMonitor - System Integrity Classes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BSP Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsp/bspCharInputOutput/doc/index.html">bspCharInputOutput</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsp/bspDynamicClient/doc/index.html">bspDynamicClient - Dynamic Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsp/bspInputManager/doc/index.html">bspInputManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsp/bspInterrupts/doc/index.html">bspInterrupts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsp/bspOutputManager/doc/index.html">bspOutputManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../libs/bsp/bspOutputPwm/doc/index.html">bspOutputPwm - Output PWM driver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BSP Modules posix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/posix/bsp/bspInterruptsImpl/doc/index.html">bspInterruptsImpl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/posix/bsp/bspMcu/doc/index.html">bspMcu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/posix/bsp/bspStdio/doc/index.html">bspStdio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/posix/bsp/bspSystemTime/doc/index.html">bspSystemTime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/posix/bsp/socketCanTransceiver/doc/index.html">socketCanTransceiver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BSP Modules s32k1xx</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspAdc/doc/index.html">bspAdc - ADC driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspClock/doc/index.html">bspClock</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspCore/doc/index.html">bspCore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspFlexCan/doc/index.html">bspFlexCan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspFtm/doc/index.html">bspFtm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspFtmPwm/doc/index.html">bspFtmPwm - FTM driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspInterruptsImpl/doc/index.html">bspInterruptsImpl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspIo/doc/index.html">bspIo - IO driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspMcu/doc/index.html">bspMcu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspMcuWatchdog/doc/index.html">bspMcuWatchdog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/bspSci/doc/index.html">bspSci</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/bsp/canflex2Transceiver/doc/index.html">canflex2Transceiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/s32k1xx/hardFaultHandler/doc/index.html">hardFaultHandler</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BSP Configuration for s32k148evb</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/s32k148evb/bspConfiguration/doc/index.html">bspConfiguration - S32k148EVB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/s32k148evb/freeRtosCoreConfiguration/doc/index.html">freeRtosCoreConfiguration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/referenceApp/platforms/s32k148evb/main/doc/index.html">main</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UT Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/unitTest/bsp/bspConfiguration/doc/index.html">bspConfiguration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/unitTest/bsp/bspInterruptsImpl/doc/index.html">bspInterruptsImpl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/unitTest/bsp/bspIo/doc/index.html">bspIo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/unitTest/bsp/bspMcu/doc/index.html">bspMcu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/unitTest/bsp/bspSci/doc/index.html">bspSci</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../executables/unitTest/common/doc/index.html">common</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analysis/index.html">Analysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Eclipse OpenBSW Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../overview.html">Getting Started</a> &raquo;</li>
        
        <li>Working with CAN</li>
    

    

      <li class="wy-breadcrumbs-aside">

        <!-- DOCUMENT STATUS -->

        

        <!-- DATA CLASSIFICATION -->

        

      </li>

    
  </ul>

  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-with-can">
<span id="learning-can"></span><h1>Working with CAN<a class="headerlink" href="#working-with-can" title="Link to this heading"></a></h1>
<p>Previous: <a class="reference internal" href="../commands/index.html#learning-commands"><span class="std std-ref">Adding commands to the console</span></a></p>
<p>The POSIX and S32K148 builds support CAN but in different ways.
The S32K148 development board has CAN hardware and this is used to send and receive CAN frames
whereas on the POSIX platform a CAN socket is used to send CAN frames to a Virtual CAN interface
(note this requires that the POSIX platform used includes <code class="docutils literal notranslate"><span class="pre">SocketCan</span></code> support).</p>
<section id="posix-build">
<h2>POSIX build<a class="headerlink" href="#posix-build" title="Link to this heading"></a></h2>
<p>Assuming you have successfully built and run the executable <code class="docutils literal notranslate"><span class="pre">app.referenceApp.elf</span></code> on a POSIX platform
as instructed in <a class="reference internal" href="../setup/setup_posix_ubuntu_build.html#setup-posix-ubuntu-build"><span class="std std-ref">Set up build environment for POSIX platform on Ubuntu 22.04</span></a>
then you may see one of the following errors during startup of <code class="docutils literal notranslate"><span class="pre">app.referenceApp.elf</span></code>…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1617576</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>ERROR:<span class="w"> </span><span class="o">[</span>SocketCanTransceiver<span class="o">]</span><span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>socket<span class="w"> </span><span class="o">(</span><span class="nv">node</span><span class="o">=</span>vcan0,<span class="w"> </span><span class="nv">error</span><span class="o">=</span>-1<span class="o">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1617576</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>ERROR:<span class="w"> </span><span class="o">[</span>SocketCanTransceiver<span class="o">]</span><span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>ioctl<span class="w"> </span>socket<span class="w"> </span><span class="o">(</span><span class="nv">node</span><span class="o">=</span>vcan0,<span class="w"> </span><span class="nv">error</span><span class="o">=</span>-1<span class="o">)</span>
</pre></div>
</div>
<p>which indicate that a socket could not be opened using the Virtual CAN interface <code class="docutils literal notranslate"><span class="pre">vcan0</span></code> -
you need to set it up. On Ubuntu <code class="highlight highlight-prop docutils literal notranslate"><span class="pre">22.04</span></code>, the following commands will set it up…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>add<span class="w"> </span>dev<span class="w"> </span>vcan0<span class="w"> </span><span class="nb">type</span><span class="w"> </span>vcan
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>vcan0<span class="w"> </span>mtu<span class="w"> </span><span class="m">16</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>up<span class="w"> </span>vcan0
</pre></div>
</div>
<p>Note that the above commands are also in the script <code class="docutils literal notranslate"><span class="pre">tools/can/bring-up-vcan0.sh</span></code>.</p>
<p>If you see an error <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">Unknown</span> <span class="pre">device</span> <span class="pre">type.</span></code>
from the above commands then you need to figure out how to set up <code class="docutils literal notranslate"><span class="pre">SocketCan</span></code> support
and support for device type <code class="docutils literal notranslate"><span class="pre">vcan</span></code> on your platform.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note while the standard Ubuntu <code class="highlight highlight-prop docutils literal notranslate"><span class="pre">22.04</span></code> release includes <code class="docutils literal notranslate"><span class="pre">SocketCan</span></code> support,
the version of Ubuntu <code class="highlight highlight-prop docutils literal notranslate"><span class="pre">22.04</span></code> available for WSL does not
- to perform the steps in this exercise on WSL, a custom kernel would need to be created with <code class="docutils literal notranslate"><span class="pre">SocketCan</span></code> support.
See <a class="reference internal" href="../setup/setup_wsl_socketcan.html#setup-wsl-socketcan"><span class="std std-ref">Add SocketCAN support in WSL</span></a>.</p>
</div>
<p>Once <code class="docutils literal notranslate"><span class="pre">vcan0</span></code> is set up the above error messages should no longer be seen during the application’s initialization.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">DemoSystem.cpp</span></code>, the software sends a CAN frame every second with Frame ID = <code class="docutils literal notranslate"><span class="pre">0x558</span></code>
and with 4 bytes of data containing a counter.
If initialization completes successfully,
you should see a log message every second indicating a CAN frame was sent…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">2477109</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>INFO:<span class="w"> </span><span class="o">[</span>CanDemoListener<span class="o">]</span><span class="w"> </span>CAN<span class="w"> </span>frame<span class="w"> </span>sent,<span class="w"> </span><span class="nv">id</span><span class="o">=</span>0x558,<span class="w"> </span><span class="nv">length</span><span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>You can check that this is sent to <code class="docutils literal notranslate"><span class="pre">vcan0</span></code> using the utility <code class="docutils literal notranslate"><span class="pre">candump</span></code>
which can be installed on Ubuntu <code class="highlight highlight-prop docutils literal notranslate"><span class="pre">22.04</span></code> as follows…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>can-utils
</pre></div>
</div>
<p>While <code class="docutils literal notranslate"><span class="pre">app.referenceApp.elf</span></code> is running, in another shell terminal run…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>candump<span class="w"> </span>vcan0
</pre></div>
</div>
<p>and you should see the CAN frames being received every second and the counter values incrementing, like this…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vcan0<span class="w">  </span><span class="m">558</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span>
vcan0<span class="w">  </span><span class="m">558</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">01</span>
vcan0<span class="w">  </span><span class="m">558</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">02</span>
vcan0<span class="w">  </span><span class="m">558</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">03</span>
vcan0<span class="w">  </span><span class="m">558</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">04</span>
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">cansend</span></code> (also installed with <code class="docutils literal notranslate"><span class="pre">can-utils</span></code>) you can send a CAN frame to <code class="docutils literal notranslate"><span class="pre">vcan0</span></code>.
With <code class="docutils literal notranslate"><span class="pre">app.referenceApp.elf</span></code> running in one shell terminal and <code class="docutils literal notranslate"><span class="pre">candump</span> <span class="pre">vcan0</span></code> running in another shell terminal,
open a third shell terminal and send a CAN frame as follows…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cansend<span class="w"> </span>vcan0<span class="w"> </span><span class="m">321</span><span class="c1">#AABBCCDDEEFF</span>
</pre></div>
</div>
<p>The above command sends a CAN Frame with ID = <code class="docutils literal notranslate"><span class="pre">0x321</span></code> and 6 bytes of data <code class="docutils literal notranslate"><span class="pre">0xAABBCCDDEEFF</span></code> to <code class="docutils literal notranslate"><span class="pre">vcan0</span></code>.
You should see it in the output from <code class="docutils literal notranslate"><span class="pre">candump</span> <span class="pre">vcan0</span></code> like this…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vcan0<span class="w">  </span><span class="m">321</span><span class="w">   </span><span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w">  </span>AA<span class="w"> </span>BB<span class="w"> </span>CC<span class="w"> </span>DD<span class="w"> </span>EE<span class="w"> </span>FF
</pre></div>
</div>
<p>and you should see it being received by the application in its log like this…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">14658083</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>DEBUG:<span class="w"> </span><span class="o">[</span>SocketCanTransceiver<span class="o">]</span><span class="w"> </span>received<span class="w"> </span>CAN<span class="w"> </span>frame,<span class="w"> </span><span class="nv">id</span><span class="o">=</span>0x321,<span class="w"> </span><span class="nv">length</span><span class="o">=</span><span class="m">6</span>
</pre></div>
</div>
<p>Next, take a look at the code in <code class="docutils literal notranslate"><span class="pre">referenceApp/executables/referenceApp/application/src/app/CanDemoListener.cpp</span></code>.
You should see this code in <code class="docutils literal notranslate"><span class="pre">CanDemoListener::init()</span></code>…</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">_canFilter</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mh">0x123</span><span class="p">);</span>
<span class="n">_canFilter</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mh">0x124</span><span class="p">);</span>
</pre></div>
</div>
<p>This sets up <code class="docutils literal notranslate"><span class="pre">CanDemoListener</span></code> as a listener for CAN frames with these IDs.
If these are received then <code class="docutils literal notranslate"><span class="pre">CanDemoListener::frameReceived</span></code> will be called, which contains…</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">CanDemoListener::frameReceived</span><span class="p">(</span><span class="o">::</span><span class="n">can</span><span class="o">::</span><span class="n">CANFrame</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">frame</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Logger</span><span class="o">::</span><span class="n">info</span><span class="p">(</span>
<span class="w">        </span><span class="n">CAN</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;[CanDemoListener] received CAN frame, id=0x%X, length=%d&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">frame</span><span class="p">.</span><span class="n">getId</span><span class="p">(),</span>
<span class="w">        </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">frame</span><span class="p">.</span><span class="n">getPayloadLength</span><span class="p">());</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_canTransceiver</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">::</span><span class="n">can</span><span class="o">::</span><span class="n">CANFrame</span><span class="w"> </span><span class="n">newFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="n">getPayload</span><span class="p">(),</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="n">getPayloadLength</span><span class="p">());</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_canTransceiver</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="n">newFrame</span><span class="p">);</span>
<span class="w">        </span><span class="n">Logger</span><span class="o">::</span><span class="n">info</span><span class="p">(</span><span class="n">CAN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[CanDemoListener] response queued, result = %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">result</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This code means that if a CAN Frame with ID <code class="docutils literal notranslate"><span class="pre">0x123</span></code> or <code class="docutils literal notranslate"><span class="pre">0x124</span></code> is received,
then a new frame is created with the same data and its ID incremented by 1
and is transmitted by the CAN transceiver.</p>
<p>Let’s test that.
With <code class="docutils literal notranslate"><span class="pre">app.referenceApp.elf</span></code> running in one shell terminal, <code class="docutils literal notranslate"><span class="pre">candump</span> <span class="pre">vcan0</span></code> running in another shell terminal,
in a third shell terminal send a CAN frame as follows…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cansend<span class="w"> </span>vcan0<span class="w"> </span><span class="m">124</span><span class="c1">#88776655</span>
</pre></div>
</div>
<p>In the application’s log output you should see…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">16040039</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>DEBUG:<span class="w"> </span><span class="o">[</span>SocketCanTransceiver<span class="o">]</span><span class="w"> </span>received<span class="w"> </span>CAN<span class="w"> </span>frame,<span class="w"> </span><span class="nv">id</span><span class="o">=</span>0x124,<span class="w"> </span><span class="nv">length</span><span class="o">=</span><span class="m">4</span>
<span class="m">16040039</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>INFO:<span class="w"> </span><span class="o">[</span>CanDemoListener<span class="o">]</span><span class="w"> </span>received<span class="w"> </span>CAN<span class="w"> </span>frame,<span class="w"> </span><span class="nv">id</span><span class="o">=</span>0x124,<span class="w"> </span><span class="nv">length</span><span class="o">=</span><span class="m">4</span>
<span class="m">16040039</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>INFO:<span class="w"> </span><span class="o">[</span>CanDemoListener<span class="o">]</span><span class="w"> </span>response<span class="w"> </span>queued,<span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="m">16040041</span>:<span class="w"> </span>RefApp:<span class="w"> </span>CAN:<span class="w"> </span>INFO:<span class="w"> </span><span class="o">[</span>CanDemoListener<span class="o">]</span><span class="w"> </span>CAN<span class="w"> </span>frame<span class="w"> </span>sent,<span class="w"> </span><span class="nv">id</span><span class="o">=</span>0x125,<span class="w"> </span><span class="nv">length</span><span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>and in the output from <code class="docutils literal notranslate"><span class="pre">candump</span> <span class="pre">vcan0</span></code> you should see…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vcan0<span class="w">  </span><span class="m">124</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">88</span><span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="m">66</span><span class="w"> </span><span class="m">55</span>
vcan0<span class="w">  </span><span class="m">125</span><span class="w">   </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w">  </span><span class="m">88</span><span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="m">66</span><span class="w"> </span><span class="m">55</span>
</pre></div>
</div>
<p>which shows the frame with ID <code class="docutils literal notranslate"><span class="pre">0x124</span></code> sent by <code class="docutils literal notranslate"><span class="pre">cansend</span></code>
and the response frame with ID <code class="docutils literal notranslate"><span class="pre">0x125</span></code> sent by the application.</p>
</section>
<section id="s32k148-build">
<h2>S32K148 build<a class="headerlink" href="#s32k148-build" title="Link to this heading"></a></h2>
<p>To prove is CAN working in a S32K148 build
you will need CAN hardware that connects to the CAN interface on the S32K148 development board’s J11 connector.
Any device that supports Classic CAN (CAN-FD is not needed) should work if its CAN parameters are set up as follows…</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head stub"><p>Bitrate</p></th>
<th class="head"><p>Sample point</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>500kbits/s</p></th>
<td><p>88%</p></td>
</tr>
</tbody>
</table>
<p>The same <code class="docutils literal notranslate"><span class="pre">DemoSystem</span></code> and <code class="docutils literal notranslate"><span class="pre">CanDemoListener</span></code> classes are used in the S32K148 and POSIX builds
(note different <code class="docutils literal notranslate"><span class="pre">CanSystem</span></code> are used)
so you should be able to see the same CAN behaviour on the S32K148
as described above for the POSIX build.</p>
<p>Find the <code class="docutils literal notranslate"><span class="pre">DemoSystem</span></code>, <code class="docutils literal notranslate"><span class="pre">CanDemoListener</span></code> and <code class="docutils literal notranslate"><span class="pre">CanSystem</span></code> classes and examine how these work.
In particular note that for the POSIX build, <code class="docutils literal notranslate"><span class="pre">CanSystem</span></code> is implemented using <code class="docutils literal notranslate"><span class="pre">::can::SocketCanTransceiver</span></code>
whereas for the S32K148 build, <code class="docutils literal notranslate"><span class="pre">CanSystem</span></code> is implemented using <code class="docutils literal notranslate"><span class="pre">bios::CanFlex2Transceiver</span></code>
both of which are alternative implementations of <code class="docutils literal notranslate"><span class="pre">::can::AbstractCANTransceiver</span></code>.</p>
<p>Next: <a class="reference internal" href="../uds/index.html#learning-uds"><span class="std std-ref">Using UDS</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Accenture.</p>
  </div>

  <div role="footer_string">
    <p>Documentation from 2025-07-11 12:41:26, official build.</p>

    
      <a href="../../../_sources/doc/learning/can/index.rst.txt" rel="nofollow"> View page source</a>
    

  </div>

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>