<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Eclipse OpenBSW: util::memory::BuddyMemoryManager Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Eclipse OpenBSW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="../../de/d42/classutil_1_1memory_1_1BuddyMemoryManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">util::memory::BuddyMemoryManager Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../db/d83/BuddyMemoryManager_8h_source.html">BuddyMemoryManager.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for util::memory::BuddyMemoryManager:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d05/classutil_1_1memory_1_1BuddyMemoryManager__inherit__graph.png" border="0" usemap="#autil_1_1memory_1_1BuddyMemoryManager_inherit__map" alt="Inheritance graph"/></div>
<map name="autil_1_1memory_1_1BuddyMemoryManager_inherit__map" id="autil_1_1memory_1_1BuddyMemoryManager_inherit__map">
<area shape="rect" title=" " alt="" coords="5,80,213,121"/>
<area shape="rect" href="../../d6/d7b/classutil_1_1memory_1_1declare_1_1BuddyMemoryManager.html" title=" " alt="" coords="17,169,202,225"/>
<area shape="rect" title=" " alt="" coords="48,5,171,32"/>
</map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for util::memory::BuddyMemoryManager:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/dbc/classutil_1_1memory_1_1BuddyMemoryManager__coll__graph.png" border="0" usemap="#autil_1_1memory_1_1BuddyMemoryManager_coll__map" alt="Collaboration graph"/></div>
<map name="autil_1_1memory_1_1BuddyMemoryManager_coll__map" id="autil_1_1memory_1_1BuddyMemoryManager_coll__map">
<area shape="rect" title=" " alt="" coords="5,80,213,121"/>
<area shape="rect" title=" " alt="" coords="48,5,171,32"/>
</map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dd4/classutil_1_1memory_1_1BuddyMemoryManager_1_1AcquireResult.html">AcquireResult</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac003ca914f98688827f66806d55c7a32"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html#ac003ca914f98688827f66806d55c7a32">BuddyMemoryManager</a> (::etl::span&lt; uint8_t &gt; nodeTree)</td></tr>
<tr class="separator:ac003ca914f98688827f66806d55c7a32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae98124d4073cf757b30a6b4420df51e4"><td class="memItemLeft" align="right" valign="top"><a id="ae98124d4073cf757b30a6b4420df51e4"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>numBuckets</b> () const</td></tr>
<tr class="separator:ae98124d4073cf757b30a6b4420df51e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c13645735bd4e7fd7f23ad2ac47163a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html#a5c13645735bd4e7fd7f23ad2ac47163a">clear</a> ()</td></tr>
<tr class="separator:a5c13645735bd4e7fd7f23ad2ac47163a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81998d5414c70ca03c77b2a58d3bd934"><td class="memItemLeft" align="right" valign="top"><a id="a81998d5414c70ca03c77b2a58d3bd934"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>isEmpty</b> () const</td></tr>
<tr class="separator:a81998d5414c70ca03c77b2a58d3bd934"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cc8b1d5caa95df184d97490164aa3c4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/dd4/classutil_1_1memory_1_1BuddyMemoryManager_1_1AcquireResult.html">AcquireResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html#a5cc8b1d5caa95df184d97490164aa3c4">acquireMemory</a> (size_t numBuckets)</td></tr>
<tr class="separator:a5cc8b1d5caa95df184d97490164aa3c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2897bbb6359c23f056b9c374c8973d3d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html#a2897bbb6359c23f056b9c374c8973d3d">releaseMemory</a> (size_t bucketIndex)</td></tr>
<tr class="separator:a2897bbb6359c23f056b9c374c8973d3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af13ac0612557ace9b6ba45529e83b665"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html#af13ac0612557ace9b6ba45529e83b665">releaseMemoryExtended</a> (size_t bucketIndex)</td></tr>
<tr class="separator:af13ac0612557ace9b6ba45529e83b665"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a9b05438d6af9ee5ddf5d32d028809243"><td class="memItemLeft" align="right" valign="top"><a id="a9b05438d6af9ee5ddf5d32d028809243"></a>
static constexpr uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>TAG_NODE_FREE</b> = 0x02U</td></tr>
<tr class="separator:a9b05438d6af9ee5ddf5d32d028809243"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a743318174779a7fc94ef2cc8c7dc68a5"><td class="memItemLeft" align="right" valign="top"><a id="a743318174779a7fc94ef2cc8c7dc68a5"></a>
static constexpr uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>TAG_NODE_LINK</b> = 0x01U</td></tr>
<tr class="separator:a743318174779a7fc94ef2cc8c7dc68a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd356bdd717c63791284d1d23d8cbfff"><td class="memItemLeft" align="right" valign="top"><a id="abd356bdd717c63791284d1d23d8cbfff"></a>
static constexpr uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>TAG_NODE_USED</b> = 0x00U</td></tr>
<tr class="separator:abd356bdd717c63791284d1d23d8cbfff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of buddy memory allocation, which is configured through its constructor parameters.</p>
<h1><a class="anchor" id="implementation"></a>
Implementation</h1>
<p>The internal implementation is based on a full binary tree. Initially the root node will be marked free, and all other nodes will be link nodes.</p>
<p>Suppose you created an instance of <a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html">BuddyMemoryManager</a>, with memorySize 2052 and treeDepth 3. The initial binary tree would be </p><div class="dotgraph">
<img src="../../dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
</div>
<h2><a class="anchor" id="buddy"></a>
The Buddy</h2>
<p>The buddy of a node (this is where the name of the algorithm comes from) is its sibling, i.e. its left neighbor, if the node is a right child or vice versa.</p>
<h2><a class="anchor" id="allocation"></a>
Allocate Memory</h2>
<p>If you request a chunk of memory, the algorithm will look for the smallest node that could handle your request. Note, that all nodes of a tree level have the same size, so it'll actually determine the appropriate level and look for a free node. If there's no free node, the algorithm will go up one level, search a free node and split it. This is done until the root node is reached.</p>
<p>To continue with the example, let's suppose you requested 200 bytes of memory, which would be in level 2. No node is free, as well as in level 1, so the root node is split. </p><div class="dotgraph">
<img src="../../dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
</div>
<p>After that, the first node in level 1 will be split. </p><div class="dotgraph">
<img src="../../dot_inline_dotgraph_3.png" alt="dot_inline_dotgraph_3.png" border="0" usemap="#dot_inline_dotgraph_3.map"/>
</div>
<p> Finally, the first node in level 2 will be marked used and the attached chunk of memory will be returned. </p><div class="dotgraph">
<img src="../../dot_inline_dotgraph_4.png" alt="dot_inline_dotgraph_4.png" border="0" usemap="#dot_inline_dotgraph_4.map"/>
</div>
<h2><a class="anchor" id="free"></a>
Free Memory</h2>
<p>When you free a chunk of memory, the algorithm will locate the node and see if it's buddy is also free. If so, it'll merge both and mark them link nodes again and free the parent. This is done until the root node is reached.</p>
<h2><a class="anchor" id="complexity"></a>
Runtime Complexity</h2>
<p>The runtime complexity of allocate and free is log2(n), where n is the number of nodes in the tree, i.e. it is based on the depth of the tree. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac003ca914f98688827f66806d55c7a32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac003ca914f98688827f66806d55c7a32">&#9670;&nbsp;</a></span>BuddyMemoryManager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">util::memory::BuddyMemoryManager::BuddyMemoryManager </td>
          <td>(</td>
          <td class="paramtype">::etl::span&lt; uint8_t &gt;&#160;</td>
          <td class="paramname"><em>nodeTree</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructs an instance of <a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html">BuddyMemoryManager</a>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nodeTree</td><td>Slice of internal binary tree. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5cc8b1d5caa95df184d97490164aa3c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cc8b1d5caa95df184d97490164aa3c4">&#9670;&nbsp;</a></span>acquireMemory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/dd4/classutil_1_1memory_1_1BuddyMemoryManager_1_1AcquireResult.html">BuddyMemoryManager::AcquireResult</a> util::memory::BuddyMemoryManager::acquireMemory </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numBuckets</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Acquires a given number of buckets. </p><dl class="section return"><dt>Returns</dt><dd><ul>
<li>Bucket index and number of buckets acquired</li>
<li>Invalid result if the requested amount of buckets was not available </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a5c13645735bd4e7fd7f23ad2ac47163a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c13645735bd4e7fd7f23ad2ac47163a">&#9670;&nbsp;</a></span>clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void util::memory::BuddyMemoryManager::clear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Marks the complete memory free. </p>

</div>
</div>
<a id="a2897bbb6359c23f056b9c374c8973d3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2897bbb6359c23f056b9c374c8973d3d">&#9670;&nbsp;</a></span>releaseMemory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool util::memory::BuddyMemoryManager::releaseMemory </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bucketIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Frees a given chunk of memory. </p><dl class="section return"><dt>Returns</dt><dd><ul>
<li>true if memory starting with bucket at bucketIndex was occupied</li>
<li>false otherwise </li>
</ul>
</dd></dl>

</div>
</div>
<a id="af13ac0612557ace9b6ba45529e83b665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af13ac0612557ace9b6ba45529e83b665">&#9670;&nbsp;</a></span>releaseMemoryExtended()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t util::memory::BuddyMemoryManager::releaseMemoryExtended </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bucketIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Frees a given chunk of memory. </p><dl class="section return"><dt>Returns</dt><dd>Number of freed buckets. Zero on error; </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../db/d83/BuddyMemoryManager_8h_source.html">BuddyMemoryManager.h</a></li>
<li>BuddyMemoryManager.cpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>util</b></li><li class="navelem"><b>memory</b></li><li class="navelem"><a class="el" href="../../de/dc0/classutil_1_1memory_1_1BuddyMemoryManager.html">BuddyMemoryManager</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
